<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>

<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; }
#score {
  position: absolute;
  top: 20px;
  left: 50%;
  transform: translateX(-50%);
  color: white;
  font-size: 28px;
  font-weight: bold;
  text-shadow: 2px 2px black;
}
</style>
</head>

<body>

<div id="score">Tap to Start</div>
<canvas id="c"></canvas>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

// Images
const bg = new Image();
bg.src = "moon.png";

const birdImg = new Image();
birdImg.src = "toppng.com-grey-cartoon-bird-design-600x550.png";

const pipeImg = new Image();
pipeImg.src = "toppng.com-flappy-bird-pipe-transparent-281x1080.png";

// Bird (قريب جدًا من الأصلي)
let bird = {
  x: canvas.width * 0.25,
  y: canvas.height / 2,
  w: 34,
  h: 26,
  v: 0
};

// Physics
let gravity = 0.35;
let jump = -6.5;

// Pipes
let pipes = [];
let gap = 160;
let speed = 2.2;
let frame = 0;

// Game state
let score = 0;
let started = false;
let gameOver = false;

// Controls
function tap() {
  if (!started) {
    started = true;
    gameOver = false;
    pipes = [];
    score = 0;
    bird.y = canvas.height / 2;
    bird.v = 0;
    document.getElementById("score").innerText = "0";
  }
  if (!gameOver) bird.v = jump;
}
document.addEventListener("click", tap);
document.addEventListener("keydown", e => {
  if (e.code === "Space") tap();
});

// Add pipe
function addPipe() {
  let topH = Math.random() * 220 + 40;
  pipes.push({
    x: canvas.width,
    top: topH,
    passed: false
  });
}

// Game loop
function loop() {
  ctx.drawImage(bg, 0, 0, canvas.width, canvas.height);

  if (started && !gameOver) {
    bird.v += gravity;
    bird.y += bird.v;

    if (frame % 100 === 0) addPipe();

    pipes.forEach(p => {
      p.x -= speed;

      // Collision
      if (
        bird.x + bird.w > p.x &&
        bird.x < p.x + 80 &&
        (bird.y < p.top || bird.y + bird.h > p.top + gap)
      ) {
        gameOver = true;
        document.getElementById("score").innerText = "Game Over - Tap";
      }

      // ✅ SCORE FIX (هنا الحل)
      if (!p.passed && bird.x > p.x + 40) {
        p.passed = true;
        score++;
        document.getElementById("score").innerText = score;
      }

      // Top pipe
      ctx.save();
      ctx.translate(p.x + 40, p.top / 2);
      ctx.scale(1, -1);
      ctx.drawImage(pipeImg, -40, -p.top / 2, 80, p.top);
      ctx.restore();

      // Bottom pipe
      ctx.drawImage(
        pipeImg,
        p.x,
        p.top + gap,
        80,
        canvas.height
      );
    });

    pipes = pipes.filter(p => p.x > -100);

    if (bird.y < 0 || bird.y + bird.h > canvas.height) {
      gameOver = true;
      document.getElementById("score").innerText = "Game Over - Tap";
    }
  }

  ctx.drawImage(birdImg, bird.x, bird.y, bird.w, bird.h);

  frame++;
  requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
