<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird</title>
<style>
  body { margin:0; overflow:hidden; font-family:sans-serif; background:black;}
  canvas { display:block; margin:auto; background:#70c5ce; }
  #scoreBoard { position:absolute; top:10px; left:50%; transform:translateX(-50%);
                color:white; font-size:24px; font-weight:bold; text-shadow: 2px 2px #000;}
</style>
</head>
<body>

<div id="scoreBoard">Score: 0 | High: 0</div>
<canvas id="gameCanvas" width="400" height="500"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');

// Images
const bgImg = new Image();
bgImg.src = 'moon.png';
const birdImg = new Image();
birdImg.src = 'toppng.com-grey-cartoon-bird-design-600x550.png';
const pipeImg = new Image();
pipeImg.src = 'toppng.com-flappy-bird-pipe-transparent-281x1080.png';
const gameOverImg = new Image();
gameOverImg.src = 'message.png';

// Bird
let bird = {x:100, y:250, w:50, h:40, dy:0};
let gravity = 0.5;
let jump = -8;

// Pipes
let pipes = [];
let pipeGap = 150;
let pipeWidth = 80;

// Score
let score = 0;
let highScore = localStorage.getItem('flappyHigh') || 0;

// Game state
let gameActive = false;
let frameCount = 0;

// Controls
document.addEventListener('keydown', () => { if(gameActive) bird.dy = jump; else resetGame(); });
document.addEventListener('click', () => { if(gameActive) bird.dy = jump; else resetGame(); });

// Reset game
function resetGame() {
    gameActive = true;
    bird.y = 250;
    bird.dy = 0;
    pipes = [];
    score = 0;
}

// Create pipe
function createPipe() {
    let pipeHeight = Math.floor(Math.random()*200) + 100;
    // Top pipe (y, h) so it's flipped
    pipes.push({x:canvas.width, y:0, w:pipeWidth, h:pipeHeight, flipped:true});
    // Bottom pipe
    pipes.push({x:canvas.width, y:pipeHeight+pipeGap, w:pipeWidth, h:canvas.height, flipped:false});
}

// Draw everything
function draw(){
    // Background
    ctx.drawImage(bgImg,0,0,canvas.width,canvas.height);

    // Bird
    ctx.drawImage(birdImg,bird.x,bird.y,bird.w,bird.h);

    // Pipes
    pipes.forEach(pipe=>{
        if(pipe.flipped){
            // Save context, flip vertically
            ctx.save();
            ctx.translate(pipe.x + pipe.w/2, pipe.y + pipe.h/2);
            ctx.scale(1,-1); // flip vertically
            ctx.drawImage(pipeImg,-pipe.w/2,-pipe.h/2,pipe.w,pipe.h);
            ctx.restore();
        } else {
            ctx.drawImage(pipeImg,pipe.x,pipe.y,pipe.w,pipe.h);
        }
    });

    // Game Over
    if(!gameActive){
        ctx.drawImage(gameOverImg, canvas.width/2 - gameOverImg.width/4, canvas.height/2 - gameOverImg.height/4,
                      gameOverImg.width/2, gameOverImg.height/2);
    }
}

// Game loop
function loop(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(gameActive){
        // Bird physics
        bird.dy += gravity;
        bird.y += bird.dy;

        // Pipes logic
        if(frameCount % 90 ===0) createPipe();
        pipes.forEach(pipe=>{
            pipe.x -= 3;

            // Collision
            if(bird.x < pipe.x+pipe.w && bird.x+bird.w > pipe.x &&
               bird.y < pipe.y+pipe.h && bird.y+bird.h > pipe.y){
                gameActive = false;
            }
        });

        // Scoring: increase when bird passes a pipe (top pipe only)
        pipes.forEach(pipe=>{
            if(pipe.flipped && !pipe.passed && bird.x > pipe.x + pipe.w){
                score++;
                pipe.passed = true;
                if(score>highScore){
                    highScore = score;
                    localStorage.setItem('flappyHigh',highScore);
                }
            }
        });

        // Remove offscreen pipes
        pipes = pipes.filter(pipe => pipe.x + pipe.w > 0);

        // Ground / ceiling
        if(bird.y+bird.h>canvas.height || bird.y<0) gameActive = false;
    }

    draw();

    // Update score
    document.getElementById('scoreBoard').innerText = `Score: ${score} | High: ${highScore}`;

    frameCount++;
    requestAnimationFrame(loop);
}

loop();
</script>

</body>
</html>
